# Story 2.3: Counselor Category Cards UI

**Epic:** Epic 2 - Counselor Dashboard & Category Management  
**Status:** Draft  
**Created:** December 20, 2025  
**Last Updated:** December 20, 2025

---

## Story

**As a** student,  
**I want** to see counselor categories as visually distinct cards,  
**so that** I can easily identify which type of counseling I need.

---

## Acceptance Criteria

1. Dashboard fetches counselor categories from GET /api/counselors/categories on page load.
2. Each category rendered as a card using shadcn/ui Card component with: category icon, category name as heading, description text, two action buttons (Voice Call, Video Call).
3. Cards arranged in responsive grid: 1 column on mobile (<640px), 2 columns on tablet (640-1024px), 3-4 columns on desktop (1024px+).
4. Card styling follows branding guidelines: soft blue primary color, rounded corners, subtle shadow on hover.
5. Icons for each category are visually appropriate and sourced from icon library (Lucide React or similar).
6. Cards have hover state showing slight elevation increase and border color change.
7. Voice Call and Video Call buttons styled distinctly (icons: microphone for voice, video camera for video).
8. Loading state shown while categories fetch (skeleton cards or spinner).
9. Error state displayed if categories fail to load with retry button.

---

## Tasks / Subtasks

- [ ] Create API client function (AC: 1)
  - [ ] Add `getCategories()` function to `lib/api.ts`
  - [ ] Use apiRequest helper with credentials
  - [ ] Handle response parsing
  - [ ] Add TypeScript types for category data
  
- [ ] Create CounselorCard component (AC: 2, 4, 5, 6, 7)
  - [ ] Create `components/dashboard/CounselorCard.tsx`
  - [ ] Use shadcn/ui Card, CardHeader, CardContent, CardFooter
  - [ ] Import Lucide React icons
  - [ ] Display category icon with proper size and color
  - [ ] Display category name as heading
  - [ ] Display description text
  - [ ] Add Voice Call button with Mic icon
  - [ ] Add Video Call button with Video icon
  - [ ] Style with blue theme
  - [ ] Add hover state with elevation and border
  
- [ ] Create icon mapping utility (AC: 5)
  - [ ] Create `lib/icons.ts`
  - [ ] Map icon_name strings to Lucide React components
  - [ ] Handle unknown icon names gracefully
  - [ ] Export getIcon function
  
- [ ] Create CounselorCardGrid component (AC: 1, 3)
  - [ ] Create `components/dashboard/CounselorCardGrid.tsx`
  - [ ] Fetch categories on component mount
  - [ ] Store categories in local state
  - [ ] Render grid of CounselorCard components
  - [ ] Pass category data as props to cards
  - [ ] Pass click handlers for Voice/Video buttons
  
- [ ] Implement loading state (AC: 8)
  - [ ] Create skeleton card component
  - [ ] Show 6 skeleton cards while loading
  - [ ] Match skeleton dimensions to actual cards
  - [ ] Use Tailwind animate-pulse for loading effect
  
- [ ] Implement error state (AC: 9)
  - [ ] Create error display component
  - [ ] Show friendly error message
  - [ ] Add retry button
  - [ ] Call fetch function again on retry
  - [ ] Log errors for debugging
  
- [ ] Integrate into dashboard page (AC: 3)
  - [ ] Import CounselorCardGrid in dashboard/page.tsx
  - [ ] Replace placeholder content with CounselorCardGrid
  - [ ] Verify responsive grid works at all breakpoints

---

## Dev Notes

### API Client Implementation

**lib/api.ts additions:**
```typescript
export interface CounselorCategory {
  id: string;
  name: string;
  description: string;
  icon_name: string;
}

export interface CounselorCategoriesResponse {
  categories: CounselorCategory[];
  total: number;
}

export async function getCategories(): Promise<CounselorCategory[]> {
  const response = await apiRequest<CounselorCategoriesResponse>(
    '/counselors/categories'
  );
  return response.categories;
}
```

### Icon Mapping Utility

**lib/icons.ts:**
```typescript
import { 
  HeartPulse, 
  Briefcase, 
  GraduationCap, 
  DollarSign, 
  Users, 
  Star,
  HelpCircle,
  LucideIcon
} from 'lucide-react';

const iconMap: Record<string, LucideIcon> = {
  'heart-pulse': HeartPulse,
  'briefcase': Briefcase,
  'graduation-cap': GraduationCap,
  'dollar-sign': DollarSign,
  'users': Users,
  'star': Star,
};

export function getIcon(iconName: string): LucideIcon {
  return iconMap[iconName] || HelpCircle; // Fallback to help icon
}
```

### CounselorCard Component

**components/dashboard/CounselorCard.tsx:**
```typescript
'use client';

import { Card, CardHeader, CardContent, CardFooter } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Mic, Video } from 'lucide-react';
import { getIcon } from '@/lib/icons';
import { CounselorCategory } from '@/lib/api';

interface CounselorCardProps {
  category: CounselorCategory;
  onVoiceCall: (category: CounselorCategory) => void;
  onVideoCall: (category: CounselorCategory) => void;
}

export function CounselorCard({ category, onVoiceCall, onVideoCall }: CounselorCardProps) {
  const Icon = getIcon(category.icon_name);
  
  return (
    <Card className="group hover:shadow-lg hover:border-blue-300 transition-all duration-200 h-full flex flex-col">
      <CardHeader>
        <div className="flex items-center gap-3">
          <div className="p-3 bg-blue-50 rounded-lg group-hover:bg-blue-100 transition-colors">
            <Icon className="h-6 w-6 text-blue-600" />
          </div>
          <h3 className="text-xl font-semibold text-gray-900">
            {category.name}
          </h3>
        </div>
      </CardHeader>
      
      <CardContent className="flex-1">
        <p className="text-gray-600 text-sm leading-relaxed">
          {category.description}
        </p>
      </CardContent>
      
      <CardFooter className="flex gap-2 pt-4">
        <Button
          onClick={() => onVoiceCall(category)}
          className="flex-1 gap-2 bg-blue-600 hover:bg-blue-700"
          aria-label={`Start voice call with ${category.name} counselor`}
        >
          <Mic className="h-4 w-4" />
          Voice Call
        </Button>
        <Button
          onClick={() => onVideoCall(category)}
          variant="outline"
          className="flex-1 gap-2 border-blue-600 text-blue-600 hover:bg-blue-50"
          aria-label={`Start video call with ${category.name} counselor`}
        >
          <Video className="h-4 w-4" />
          Video Call
        </Button>
      </CardFooter>
    </Card>
  );
}
```

### CounselorCardGrid Component

**components/dashboard/CounselorCardGrid.tsx:**
```typescript
'use client';

import { useEffect, useState } from 'react';
import { CounselorCard } from './CounselorCard';
import { CounselorCardSkeleton } from './CounselorCardSkeleton';
import { getCategories, CounselorCategory } from '@/lib/api';
import { Button } from '@/components/ui/button';
import { AlertCircle } from 'lucide-react';

export function CounselorCardGrid() {
  const [categories, setCategories] = useState<CounselorCategory[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  
  const fetchCategories = async () => {
    setIsLoading(true);
    setError(null);
    
    try {
      const data = await getCategories();
      setCategories(data);
    } catch (err) {
      console.error('Failed to fetch categories:', err);
      setError('Unable to load counselor categories. Please try again.');
    } finally {
      setIsLoading(false);
    }
  };
  
  useEffect(() => {
    fetchCategories();
  }, []);
  
  const handleVoiceCall = (category: CounselorCategory) => {
    console.log('Voice call requested for:', category.name);
    // Placeholder - will be implemented in Story 2.4
  };
  
  const handleVideoCall = (category: CounselorCategory) => {
    console.log('Video call requested for:', category.name);
    // Placeholder - will be implemented in Story 2.5
  };
  
  if (isLoading) {
    return (
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        {Array.from({ length: 6 }).map((_, i) => (
          <CounselorCardSkeleton key={i} />
        ))}
      </div>
    );
  }
  
  if (error) {
    return (
      <div className="flex flex-col items-center justify-center py-12 gap-4">
        <AlertCircle className="h-12 w-12 text-red-500" />
        <p className="text-gray-600 text-center max-w-md">{error}</p>
        <Button onClick={fetchCategories} variant="outline">
          Try Again
        </Button>
      </div>
    );
  }
  
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      {categories.map((category) => (
        <CounselorCard
          key={category.id}
          category={category}
          onVoiceCall={handleVoiceCall}
          onVideoCall={handleVideoCall}
        />
      ))}
    </div>
  );
}
```

### Skeleton Card Component

**components/dashboard/CounselorCardSkeleton.tsx:**
```typescript
import { Card, CardHeader, CardContent, CardFooter } from '@/components/ui/card';

export function CounselorCardSkeleton() {
  return (
    <Card className="h-full flex flex-col">
      <CardHeader>
        <div className="flex items-center gap-3">
          <div className="h-12 w-12 bg-gray-200 rounded-lg animate-pulse" />
          <div className="h-6 w-32 bg-gray-200 rounded animate-pulse" />
        </div>
      </CardHeader>
      
      <CardContent className="flex-1 space-y-2">
        <div className="h-4 bg-gray-200 rounded animate-pulse" />
        <div className="h-4 bg-gray-200 rounded animate-pulse w-5/6" />
        <div className="h-4 bg-gray-200 rounded animate-pulse w-4/6" />
      </CardContent>
      
      <CardFooter className="flex gap-2 pt-4">
        <div className="flex-1 h-10 bg-gray-200 rounded animate-pulse" />
        <div className="flex-1 h-10 bg-gray-200 rounded animate-pulse" />
      </CardFooter>
    </Card>
  );
}
```

### Card Styling Guidelines

**Colors:**
- Primary Blue: `bg-blue-600`, `hover:bg-blue-700`
- Blue Accent: `bg-blue-50`, `border-blue-300`
- Gray Text: `text-gray-600`, `text-gray-900`

**Hover Effects:**
- Shadow: `hover:shadow-lg` (from `shadow` to `shadow-lg`)
- Border: `hover:border-blue-300` (from default to blue)
- Icon Background: `group-hover:bg-blue-100` (from blue-50 to blue-100)
- Smooth Transition: `transition-all duration-200`

**Card Dimensions:**
- Equal height: `h-full flex flex-col` on Card
- Flex grow on CardContent: `flex-1`
- Consistent padding from shadcn/ui Card components

### Responsive Grid

**Grid Classes:**
```css
grid grid-cols-1        /* Mobile: 1 column */
md:grid-cols-2          /* Tablet: 2 columns (768px+) */
lg:grid-cols-3          /* Desktop: 3 columns (1024px+) */
xl:grid-cols-4          /* Large Desktop: 4 columns (1280px+) */
gap-6                   /* 24px gap between cards */
```

### Source Tree Updates

New files to create:
```
packages/frontend/
├── components/
│   └── dashboard/
│       ├── CounselorCard.tsx         # Individual category card
│       ├── CounselorCardGrid.tsx     # Grid container with data fetching
│       └── CounselorCardSkeleton.tsx # Loading skeleton
└── lib/
    ├── api.ts                        # Add getCategories function
    └── icons.ts                      # Icon mapping utility
```

---

## Testing

### Testing Standards

**Test Locations:**
- Component tests: `__tests__/components/dashboard/`
- Integration tests: `__tests__/integration/dashboard-cards.test.tsx`

**Testing Framework:**
- Vitest 1.2.0
- React Testing Library
- MSW (Mock Service Worker) for API mocking

**Testing Requirements for This Story:**

1. **CounselorCard Component Tests:**
   ```typescript
   import { render, screen } from '@testing-library/react';
   import userEvent from '@testing-library/user-event';
   import { CounselorCard } from '@/components/dashboard/CounselorCard';
   
   const mockCategory = {
     id: '123',
     name: 'Health',
     description: 'Mental health support',
     icon_name: 'heart-pulse',
   };
   
   test('renders category information', () => {
     render(
       <CounselorCard 
         category={mockCategory}
         onVoiceCall={vi.fn()}
         onVideoCall={vi.fn()}
       />
     );
     
     expect(screen.getByText('Health')).toBeInTheDocument();
     expect(screen.getByText('Mental health support')).toBeInTheDocument();
   });
   
   test('calls onVoiceCall when voice button clicked', async () => {
     const mockVoiceCall = vi.fn();
     render(
       <CounselorCard 
         category={mockCategory}
         onVoiceCall={mockVoiceCall}
         onVideoCall={vi.fn()}
       />
     );
     
     const voiceButton = screen.getByRole('button', { name: /voice call/i });
     await userEvent.click(voiceButton);
     
     expect(mockVoiceCall).toHaveBeenCalledWith(mockCategory);
   });
   
   test('calls onVideoCall when video button clicked', async () => {
     const mockVideoCall = vi.fn();
     render(
       <CounselorCard 
         category={mockCategory}
         onVoiceCall={vi.fn()}
         onVideoCall={mockVideoCall}
       />
     );
     
     const videoButton = screen.getByRole('button', { name: /video call/i });
     await userEvent.click(videoButton);
     
     expect(mockVideoCall).toHaveBeenCalledWith(mockCategory);
   });
   
   test('renders correct icon for category', () => {
     const { container } = render(
       <CounselorCard 
         category={mockCategory}
         onVoiceCall={vi.fn()}
         onVideoCall={vi.fn()}
       />
     );
     
     // Icon should be rendered (check for SVG element)
     const icon = container.querySelector('svg');
     expect(icon).toBeInTheDocument();
   });
   ```

2. **CounselorCardGrid Component Tests:**
   ```typescript
   import { render, screen, waitFor } from '@testing-library/react';
   import { CounselorCardGrid } from '@/components/dashboard/CounselorCardGrid';
   import { server } from '@/mocks/server';
   import { rest } from 'msw';
   
   test('shows loading skeletons initially', () => {
     render(<CounselorCardGrid />);
     
     // Should show 6 skeleton cards
     const skeletons = screen.getAllByTestId('skeleton-card');
     expect(skeletons).toHaveLength(6);
   });
   
   test('renders category cards after successful fetch', async () => {
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText('Health')).toBeInTheDocument();
       expect(screen.getByText('Career')).toBeInTheDocument();
       expect(screen.getByText('Academic')).toBeInTheDocument();
     });
     
     // Should render 6 cards
     const cards = screen.getAllByRole('article'); // If Card has role="article"
     expect(cards).toHaveLength(6);
   });
   
   test('shows error message on fetch failure', async () => {
     // Mock failed API response
     server.use(
       rest.get('*/counselors/categories', (req, res, ctx) => {
         return res(ctx.status(500));
       })
     );
     
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText(/unable to load/i)).toBeInTheDocument();
     });
     
     expect(screen.getByRole('button', { name: /try again/i })).toBeInTheDocument();
   });
   
   test('retries fetch when retry button clicked', async () => {
     server.use(
       rest.get('*/counselors/categories', (req, res, ctx) => {
         return res(ctx.status(500));
       })
     );
     
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText(/unable to load/i)).toBeInTheDocument();
     });
     
     // Mock successful response for retry
     server.use(
       rest.get('*/counselors/categories', (req, res, ctx) => {
         return res(ctx.json({ categories: mockCategories, total: 6 }));
       })
     );
     
     const retryButton = screen.getByRole('button', { name: /try again/i });
     await userEvent.click(retryButton);
     
     await waitFor(() => {
       expect(screen.getByText('Health')).toBeInTheDocument();
     });
   });
   ```

3. **Icon Mapping Tests:**
   ```typescript
   import { getIcon } from '@/lib/icons';
   import { HeartPulse, HelpCircle } from 'lucide-react';
   
   test('returns correct icon for valid name', () => {
     const icon = getIcon('heart-pulse');
     expect(icon).toBe(HeartPulse);
   });
   
   test('returns fallback icon for unknown name', () => {
     const icon = getIcon('unknown-icon');
     expect(icon).toBe(HelpCircle);
   });
   ```

4. **Responsive Grid Tests:**
   ```typescript
   test('applies correct responsive grid classes', () => {
     const { container } = render(<CounselorCardGrid />);
     
     const grid = container.querySelector('.grid');
     expect(grid).toHaveClass('grid-cols-1');
     expect(grid).toHaveClass('md:grid-cols-2');
     expect(grid).toHaveClass('lg:grid-cols-3');
     expect(grid).toHaveClass('xl:grid-cols-4');
   });
   ```

5. **Accessibility Tests:**
   ```typescript
   test('cards have proper ARIA labels', () => {
     render(
       <CounselorCard 
         category={mockCategory}
         onVoiceCall={vi.fn()}
         onVideoCall={vi.fn()}
       />
     );
     
     const voiceButton = screen.getByRole('button', { 
       name: /start voice call with health counselor/i 
     });
     const videoButton = screen.getByRole('button', { 
       name: /start video call with health counselor/i 
     });
     
     expect(voiceButton).toBeInTheDocument();
     expect(videoButton).toBeInTheDocument();
   });
   ```

6. **Manual Testing Checklist:**
   - [ ] Categories load and display correctly
   - [ ] 6 skeleton cards show during loading
   - [ ] All 6 categories render as cards
   - [ ] Each card shows correct icon
   - [ ] Each card shows category name and description
   - [ ] Both buttons (Voice/Video) are visible
   - [ ] Hover effects work (shadow, border color)
   - [ ] Cards arranged in 1 column on mobile (<640px)
   - [ ] Cards arranged in 2 columns on tablet (768px)
   - [ ] Cards arranged in 3 columns on desktop (1024px)
   - [ ] Cards arranged in 4 columns on large desktop (1280px)
   - [ ] Error message displays when API fails
   - [ ] Retry button refetches categories
   - [ ] Buttons are keyboard accessible
   - [ ] Focus indicators are visible
   - [ ] Screen reader announces cards correctly

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-20 | 1.0 | Initial story creation | Sarah (PO) |