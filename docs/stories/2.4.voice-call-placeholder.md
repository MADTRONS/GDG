# Story 2.4: Voice Call Button (Placeholder Action)

**Epic:** Epic 2 - Counselor Dashboard & Category Management  
**Status:** Ready for Review  
**Created:** December 20, 2025  
**Last Updated:** December 21, 2025

---

## Story

**As a** student,  
**I want** clicking Voice Call button to provide feedback (even if calling not yet implemented),  
**so that** I understand the platform recognizes my action and will connect me once the feature is complete.

---

## Acceptance Criteria

1. Voice Call button on each counselor card is interactive and styled as primary action.
2. Clicking Voice Call button displays a toast notification: "Voice calling will be available in the next update. Stay tuned!"
3. Console logs the selected counselor category for debugging purposes.
4. Button includes loading state (disabled while notification shows) to prevent double-clicks.
5. All voice call button interactions keyboard accessible (Enter key triggers action).

---

## Tasks / Subtasks

- [x] Install toast notification library (AC: 2)
  - [x] Install react-hot-toast or use shadcn/ui toast
  - [x] Configure toast provider in app layout
  - [x] Test toast appears correctly
  
- [x] Update CounselorCardGrid with voice call handler (AC: 2, 3)
  - [x] Implement handleVoiceCall function
  - [x] Show toast notification with placeholder message
  - [x] Log category name to console
  - [x] Log category ID for debugging
  
- [x] Add loading state to voice button (AC: 4)
  - [x] Add loading state to CounselorCard component
  - [x] Disable voice button during action
  - [x] Show loading spinner on button
  - [x] Auto-enable after toast dismisses
  
- [x] Verify keyboard accessibility (AC: 5)
  - [x] Test Tab navigation to voice button
  - [x] Test Enter key triggers onClick
  - [x] Test Space key triggers onClick
  - [x] Ensure focus indicator is visible
  
- [x] Add analytics/telemetry (optional)
  - [x] Log which categories students are interested in
  - [x] Track button click events
  - [x] Prepare for future A/B testing

---

## Dev Notes

### Toast Notification Implementation

**Using shadcn/ui Toast (Recommended):**

1. **Install toast component:**
```bash
pnpx shadcn-ui@latest add toast
```

2. **Add Toaster to layout:**
```typescript
// app/layout.tsx
import { Toaster } from '@/components/ui/toaster';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <AuthProvider>
          {children}
          <Toaster />
        </AuthProvider>
      </body>
    </html>
  );
}
```

3. **Use toast in components:**
```typescript
import { useToast } from '@/components/ui/use-toast';

const { toast } = useToast();

toast({
  title: "Coming Soon",
  description: "Voice calling will be available in the next update. Stay tuned!",
  duration: 4000,
});
```

**Alternative: react-hot-toast:**
```typescript
import toast from 'react-hot-toast';

toast('Voice calling will be available in the next update. Stay tuned!', {
  icon: 'ðŸŽ¤',
  duration: 4000,
});
```

### Updated CounselorCardGrid Component

**components/dashboard/CounselorCardGrid.tsx (updated):**
```typescript
'use client';

import { useEffect, useState } from 'react';
import { CounselorCard } from './CounselorCard';
import { getCategories, CounselorCategory } from '@/lib/api';
import { useToast } from '@/components/ui/use-toast';

export function CounselorCardGrid() {
  const [categories, setCategories] = useState<CounselorCategory[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [loadingVoice, setLoadingVoice] = useState<string | null>(null);
  const [loadingVideo, setLoadingVideo] = useState<string | null>(null);
  const { toast } = useToast();
  
  // ... fetchCategories and useEffect ...
  
  const handleVoiceCall = async (category: CounselorCategory) => {
    console.log('Voice call requested for category:', category.name);
    console.log('Category ID:', category.id);
    
    // Set loading state
    setLoadingVoice(category.id);
    
    // Show toast notification
    toast({
      title: "Coming Soon",
      description: "Voice calling will be available in the next update. Stay tuned!",
      duration: 4000,
    });
    
    // Clear loading state after delay
    setTimeout(() => {
      setLoadingVoice(null);
    }, 4000);
  };
  
  const handleVideoCall = async (category: CounselorCategory) => {
    // Will be implemented in Story 2.5
    console.log('Video call requested for category:', category.name);
  };
  
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      {categories.map((category) => (
        <CounselorCard
          key={category.id}
          category={category}
          onVoiceCall={handleVoiceCall}
          onVideoCall={handleVideoCall}
          isVoiceLoading={loadingVoice === category.id}
          isVideoLoading={loadingVideo === category.id}
        />
      ))}
    </div>
  );
}
```

### Updated CounselorCard Component

**components/dashboard/CounselorCard.tsx (updated):**
```typescript
'use client';

import { Card, CardHeader, CardContent, CardFooter } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Mic, Video, Loader2 } from 'lucide-react';
import { getIcon } from '@/lib/icons';
import { CounselorCategory } from '@/lib/api';

interface CounselorCardProps {
  category: CounselorCategory;
  onVoiceCall: (category: CounselorCategory) => void;
  onVideoCall: (category: CounselorCategory) => void;
  isVoiceLoading?: boolean;
  isVideoLoading?: boolean;
}

export function CounselorCard({ 
  category, 
  onVoiceCall, 
  onVideoCall,
  isVoiceLoading = false,
  isVideoLoading = false
}: CounselorCardProps) {
  const Icon = getIcon(category.icon_name);
  
  return (
    <Card className="group hover:shadow-lg hover:border-blue-300 transition-all duration-200 h-full flex flex-col">
      <CardHeader>
        <div className="flex items-center gap-3">
          <div className="p-3 bg-blue-50 rounded-lg group-hover:bg-blue-100 transition-colors">
            <Icon className="h-6 w-6 text-blue-600" />
          </div>
          <h3 className="text-xl font-semibold text-gray-900">
            {category.name}
          </h3>
        </div>
      </CardHeader>
      
      <CardContent className="flex-1">
        <p className="text-gray-600 text-sm leading-relaxed">
          {category.description}
        </p>
      </CardContent>
      
      <CardFooter className="flex gap-2 pt-4">
        <Button
          onClick={() => onVoiceCall(category)}
          disabled={isVoiceLoading}
          className="flex-1 gap-2 bg-blue-600 hover:bg-blue-700"
          aria-label={`Start voice call with ${category.name} counselor`}
        >
          {isVoiceLoading ? (
            <Loader2 className="h-4 w-4 animate-spin" />
          ) : (
            <Mic className="h-4 w-4" />
          )}
          Voice Call
        </Button>
        <Button
          onClick={() => onVideoCall(category)}
          disabled={isVideoLoading}
          variant="outline"
          className="flex-1 gap-2 border-blue-600 text-blue-600 hover:bg-blue-50"
          aria-label={`Start video call with ${category.name} counselor`}
        >
          {isVideoLoading ? (
            <Loader2 className="h-4 w-4 animate-spin" />
          ) : (
            <Video className="h-4 w-4" />
          )}
          Video Call
        </Button>
      </CardFooter>
    </Card>
  );
}
```

### Toast Styling

**Custom toast styling (if using shadcn/ui):**
```typescript
toast({
  title: "Coming Soon",
  description: "Voice calling will be available in the next update. Stay tuned!",
  duration: 4000,
  className: "bg-blue-50 border-blue-200",
});
```

### Analytics/Telemetry (Optional)

**Add analytics tracking:**
```typescript
const handleVoiceCall = async (category: CounselorCategory) => {
  console.log('Voice call requested for category:', category.name);
  
  // Analytics tracking
  if (typeof window !== 'undefined' && window.gtag) {
    window.gtag('event', 'voice_call_clicked', {
      category: category.name,
      category_id: category.id,
    });
  }
  
  // Show toast...
};
```

### Keyboard Accessibility

**shadcn/ui Button component includes:**
- Automatic keyboard support (Enter and Space keys)
- Focus management
- ARIA attributes
- Disabled state handling

**No additional work needed if using shadcn/ui Button!**

---

## Testing

### Testing Standards

**Test Locations:**
- Component tests: `__tests__/components/dashboard/CounselorCard.test.tsx`
- Integration tests: `__tests__/integration/voice-call-placeholder.test.tsx`

**Testing Framework:**
- Vitest 1.2.0
- React Testing Library
- Testing Library User Event

**Testing Requirements for This Story:**

1. **Voice Button Click Tests:**
   ```typescript
   import { render, screen, waitFor } from '@testing-library/react';
   import userEvent from '@testing-library/user-event';
   import { CounselorCardGrid } from '@/components/dashboard/CounselorCardGrid';
   
   test('shows toast when voice call button clicked', async () => {
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText('Health')).toBeInTheDocument();
     });
     
     const voiceButton = screen.getAllByRole('button', { name: /voice call/i })[0];
     await userEvent.click(voiceButton);
     
     await waitFor(() => {
       expect(screen.getByText(/coming soon/i)).toBeInTheDocument();
       expect(screen.getByText(/voice calling will be available/i)).toBeInTheDocument();
     });
   });
   
   test('logs category information to console', async () => {
     const consoleSpy = vi.spyOn(console, 'log');
     
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText('Health')).toBeInTheDocument();
     });
     
     const voiceButton = screen.getAllByRole('button', { name: /voice call/i })[0];
     await userEvent.click(voiceButton);
     
     expect(consoleSpy).toHaveBeenCalledWith(
       'Voice call requested for category:',
       'Health'
     );
     expect(consoleSpy).toHaveBeenCalledWith(
       'Category ID:',
       expect.any(String)
     );
     
     consoleSpy.mockRestore();
   });
   ```

2. **Loading State Tests:**
   ```typescript
   test('disables button during loading', async () => {
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText('Health')).toBeInTheDocument();
     });
     
     const voiceButton = screen.getAllByRole('button', { name: /voice call/i })[0];
     await userEvent.click(voiceButton);
     
     // Button should be disabled
     expect(voiceButton).toBeDisabled();
     
     // Should show loading spinner
     await waitFor(() => {
       expect(screen.getByTestId('loader-icon')).toBeInTheDocument();
     });
     
     // Button should re-enable after timeout
     await waitFor(() => {
       expect(voiceButton).not.toBeDisabled();
     }, { timeout: 5000 });
   });
   
   test('prevents double-clicks', async () => {
     const { toast } = useToast();
     const toastSpy = vi.spyOn(toast, 'toast');
     
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText('Health')).toBeInTheDocument();
     });
     
     const voiceButton = screen.getAllByRole('button', { name: /voice call/i })[0];
     
     // Click twice rapidly
     await userEvent.click(voiceButton);
     await userEvent.click(voiceButton);
     
     // Toast should only be called once (button disabled after first click)
     expect(toastSpy).toHaveBeenCalledTimes(1);
   });
   ```

3. **Keyboard Accessibility Tests:**
   ```typescript
   test('voice button accessible via keyboard', async () => {
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText('Health')).toBeInTheDocument();
     });
     
     const voiceButton = screen.getAllByRole('button', { name: /voice call/i })[0];
     
     // Tab to button
     voiceButton.focus();
     expect(voiceButton).toHaveFocus();
     
     // Press Enter
     await userEvent.keyboard('{Enter}');
     
     await waitFor(() => {
       expect(screen.getByText(/coming soon/i)).toBeInTheDocument();
     });
   });
   
   test('voice button triggers on Space key', async () => {
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText('Health')).toBeInTheDocument();
     });
     
     const voiceButton = screen.getAllByRole('button', { name: /voice call/i })[0];
     
     voiceButton.focus();
     await userEvent.keyboard(' '); // Space key
     
     await waitFor(() => {
       expect(screen.getByText(/coming soon/i)).toBeInTheDocument();
     });
   });
   ```

4. **Toast Notification Tests:**
   ```typescript
   test('toast appears with correct message', async () => {
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText('Health')).toBeInTheDocument();
     });
     
     const voiceButton = screen.getAllByRole('button', { name: /voice call/i })[0];
     await userEvent.click(voiceButton);
     
     await waitFor(() => {
       const toast = screen.getByRole('status'); // Toast typically has role="status"
       expect(toast).toHaveTextContent(/coming soon/i);
       expect(toast).toHaveTextContent(/voice calling will be available/i);
     });
   });
   
   test('toast dismisses after duration', async () => {
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText('Health')).toBeInTheDocument();
     });
     
     const voiceButton = screen.getAllByRole('button', { name: /voice call/i })[0];
     await userEvent.click(voiceButton);
     
     // Toast appears
     await waitFor(() => {
       expect(screen.getByText(/coming soon/i)).toBeInTheDocument();
     });
     
     // Toast disappears after 4 seconds
     await waitFor(() => {
       expect(screen.queryByText(/coming soon/i)).not.toBeInTheDocument();
     }, { timeout: 5000 });
   });
   ```

5. **Multiple Categories Test:**
   ```typescript
   test('each category card has independent loading state', async () => {
     render(<CounselorCardGrid />);
     
     await waitFor(() => {
       expect(screen.getByText('Health')).toBeInTheDocument();
       expect(screen.getByText('Career')).toBeInTheDocument();
     });
     
     const voiceButtons = screen.getAllByRole('button', { name: /voice call/i });
     
     // Click first button
     await userEvent.click(voiceButtons[0]);
     
     // First button should be disabled
     expect(voiceButtons[0]).toBeDisabled();
     
     // Other buttons should still be enabled
     expect(voiceButtons[1]).not.toBeDisabled();
   });
   ```

6. **Manual Testing Checklist:**
   - [ ] Click voice call button shows toast notification
   - [ ] Toast message is: "Voice calling will be available in the next update. Stay tuned!"
   - [ ] Console logs category name and ID
   - [ ] Button is disabled during toast display
   - [ ] Loading spinner appears on button
   - [ ] Button re-enables after ~4 seconds
   - [ ] Cannot double-click button
   - [ ] Tab key can focus voice button
   - [ ] Enter key triggers voice button
   - [ ] Space key triggers voice button
   - [ ] Focus indicator is visible
   - [ ] Toast appears in correct position (usually top-right)
   - [ ] Toast auto-dismisses after 4 seconds
   - [ ] Each card's button works independently

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-20 | 1.0 | Initial story creation | Sarah (PO) |
| 2025-12-21 | 1.1 | Implemented voice call placeholder with toast notifications | James (Dev) |

---

## Dev Agent Record

**Agent Model Used:** Claude Sonnet 4.5

### Debug Log References
None

### Completion Notes
- Created shadcn/ui toast components manually (toast.tsx, toaster.tsx, use-toast.ts)
- Added Toaster to root layout for global toast notifications
- Updated CounselorCard with loading states for voice and video buttons
- Updated CounselorCardGrid with voice call handler that displays toast and logs category info
- Implemented 4-second loading state to prevent double-clicks
- All tests passing (11 tests for CounselorCardGrid including new voice call tests)
- Keyboard accessibility verified through automated tests (Enter and Space keys work)

### File List
- packages/frontend/components/ui/toast.tsx (created)
- packages/frontend/components/ui/toaster.tsx (created)
- packages/frontend/components/ui/use-toast.ts (created)
- packages/frontend/app/layout.tsx (modified)
- packages/frontend/components/dashboard/CounselorCard.tsx (modified)
- packages/frontend/components/dashboard/CounselorCardGrid.tsx (modified)
- packages/frontend/__tests__/components/dashboard/CounselorCardGrid.test.tsx (modified)